---
layout: post      # 수정 NO 
title: 5. 게시판만들기(CR), admin페이지 활용하기 # 글 제목으로 수정
category: session # 본인에게 맞는 카테고리명을 적으세요
---

세션 6 - prod. 장윤서 

# 6th session

## contents
1. model 설정하기
  *class로 모델 설정
2. admin 페이지 활용하기 
  * admin 계정 만들기 
  * admin 페이지 살펴보기
3. home (전체 글 보이는 메인 페이지) 만들기 (Read)
  * Queryset
4. detail(특정 한 게시물 보는 페이지) 만들기 (Read)
  * pk, path converter, get_object_or_404
5. new(글쓰는 페이지) 만들기 (Create)
  * method-Post


### 본격적 코딩!

가장 먼저 파일을 하나 생성하고 그 파일안에 들어간 다음 가상환경 파일을 만들어봅시다 

{% highlight html %}
python -m venv myvenv // 가상환경 파일 설치
{% endhighlight %}

그후 가상환경을 키고 django 설치까지 해봅시다

{% highlight html %}
source myvenv/Scripts/activate // 가상환경 키기 
pip install django // djnago 설치
{% endhighlight %}

django 설치가 완료 됬으면 이제 project 와 app을 만들어봅시다

{% highlight html %}
Django-admin startproject postproject// project 생성
cd postproject // postproject 파일에 들어가기
python manage.py startapp blogapp // app 생성
{% endhighlight %}

그후 postproject\postproject\settings.py에 들어가서 우리가 만들어준 app을 명시해줍시다

{% highlight html %}
	INSTALLED_APPS = [
	'django.contrib.admin',
	'django.contrib.auth',
	'django.contrib.contenttypes',
	'django.contrib.sessions',
	'django.contrib.messages',
	'django.contrib.staticfiles',
	'blogapp.apps.BlogappConfig', //앱이름.apps.첫글자대문자 앱이름Config
	]
{% endhighlight %}

### 모델 설정하기
이제 postproject\blogapp\models.py에 들어가서 우리가 어떤 형식의 글을 쓸 것인지 말해줍시다 

{% highlight html %}
	class Blog(models.Model):
  // 클래스 명을 적을땐 항상 대문자!!!
		title = models.CharField(max_length=100)
  // title 이라는 속성은 문자열 최대 길이가 100
		pub_date = models.DateTimeField('date published')
  // pub_date 라는 속성은 날짜, 시간
		body = models.TextField()
	// body라는 속성은 긴 물자열 	
		    def __str__(self):
          return self.title
  // 추후에 home 화면에서 각 글 번호가 아닌 제목으로 나타나도록 설정
{% endhighlight %}

이렇게 모델을 설정해줬으면 모델은 다른 파일들과 다르게 수정 했을 때 마다
터미널에 추가적으로 명령어를 입력해야 변경사항이 적용됩니다
이때 우리가 사용하는 DB(Data Base)는 django python과 별개이므로 
우리가 python으로 짠 코드를 받아드리도록 makemigrations 를 입력하고
migrate 통해 그 받은 내용을 적용하라고 명령어를 쳐줘야합니다 

{% highlight html %}
python manage.py makemigrations
//migration을 만들기

python manage.py migrate
//수정한 모델의 내용을 DB에 적용
{% endhighlight %}

### admin 페이지 활용하기
이제 모델이 잘 적용됬는지 확인하기 위해서 서버를 키고 admin 페이지를 통해 글을 써봅시다

먼저 postproject\blogapp\admin.py에 들어가서 admin에 Blog 모델을 사용한다는걸 명시해줍시다 
{% highlight html %}
from .models import Blog
//같은 파일에 있는 model내에 있는 Blog class 를 불러온다
admin.site.register(Blog)
//admin 사이트에 Blog class를 등록한다
{% endhighlight %}

이제 서버를 돌리고 

{% highlight html %}
python manage.py runserver
{% endhighlight %}

127.0.0.1/admin 에 접속하는 다음과 같이 로그인하라고 화면이 나옵니다 
![admin 로그인 페이지 사진]()
이때 아직 우리는 admin 계정이 없으므로 다시 터미널에 가서 admin 계정을 만드는 명령어를 칩시다
명령어를 치고 아이디와 비번을 입력해줍시다(이때 비번은 쳤을때 터미널 상으론 아무것도 안나옵니다!)

{% highlight html %}
python manage.py createsuperuser
{% endhighlight %}

admin 계정을 만든 후 로그인을 하면 다음과 같이 모델이 적용된 걸 볼 수 있습니다!
![admin 페이지 모델적용된화면 ]()

이제 blog의 add 버튼을 눌르면 다음과 같은 글쓰기 화면이 생깁니다 
![admin 글쓰는 페이지 사진]() 

양식에 맞게 글을 써주고 save를 누르면 다음과 같이 글이 보입니다!
![admin 글 목록 페이지 사진]() 

### home(글 목록이 보이는 페이지) 만들기(Read)

이젠 이렇게 만들 글이 메인 페이지에 나오도록 해봅시다 
먼저 메인페이지로 할 home 을 만들어봅시다 
자신의 app 폴더 내에 templates 라는 폴더를 만들고 그 안에 home.html이라는 파일을 만들고 다음과 같이 코드를 쳐줍시다.

{% highlight html %}
<h1> 이곳은 Home 페이지 입니다 </h1>
{% endhighlight %}

이제 사이트에 들어오면 메인 사이트인 home이 바로 나오도록 views.py와 urls.py를 설정해줍시다 

먼저 postproject\blogapp\views.py에 들어가서 다음과 같이 코드를 쳐줍니다 

{% highlight html %}
def home(request): 
  // request(요청)만 들어오면 실행되는 함수
    return render(request, 'home.html')
  // 들어온 요청에 대해 home.html을 보여준다
{% endhighlight %}

이제 postproject\postproject\urls.py에 들어가서 다음과 같이 코드를 쳐줍니다

{% highlight html %}
import blogapp.views
//blogapp의 view에 있는 함수들을 끌어온다
	
urlpatterns = [
		path('admin/', admin.site.urls),
		path('', blogapp.views.home, name="home"),
    // 맨 처음 사이트에 들어오면, blogapp에 있는 views.py에 있는 home 함수를 실행한다, 이때 이 url 이름을 home이라고 한다
]
{% endhighlight %}

이제 다시 run server를 하고 들어가보면 다음과 같은 화면이 나옵니다! 
![home 사진]() 

이제 home 화면이 나오도록 설정 했으니 home 화면에 쓴 글이 뜨도록 해봅시다!!

다시 postproject\blogapp\views.py에 들어가서 다음과 같이 코드를 쳐줍니다

{% highlight html %}
from .models import Blog
//같은 폴더 내에 있는 모델에서 Blog class를 가져온다
	
def home(request):
//요청이 들오면
		blogs = Blog.objects
//blogs 라는 변수 안에 모델로보터 받은 Blog의 객체(여기선 글 목록들)을 넣어 놓는다
//이때 Blog.objects 같은 모델로부터 받은 객체 목록을 "Queryset" 이라고 합니다
    return render(request, 'home.html', {'blogs': blogs})
// 들어온 요청에 대해서 home.html을 보여주고 있때 home.html(template)에서 위에 blogs라는 변수를 blogs라는 이름으로 가져올 것이다 
// {'blogs'= 템플릿에서 사용할 이름: blogs= view에서 설정한 변수 명}
   
{% endhighlight %}

다음은 이제 home.html로 가서 코드를 추가해줍시다 
{% highlight html %}
	{% for blog in blogs.all %}
  // views에서 설정한 글의 목록들이 담긴 blogs에서 담긴 모든 글을(blogs.all) blog로 각각 글을 하나씩 나눠 담고 
		<div class="container">
			<h1>{{ blog.title }}</h1>
      // 그 나눠 담은 글의 제목
			<p>{{ blog.pub_date }}</p>
      // 그 나눠 담은 글의 생성 시간
			<p>{{ blog.body }}</p>
      // 그 나눠 담은 글의 내용
		</div>
{% endfor %}
{% endhighlight %}

이렇게 하고 다시 사이트에 들어가면 다음과 같이 글의 제목과 내용이 뜹니다! 
![글 목록 뜨는 home 사진]() 
